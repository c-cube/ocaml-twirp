<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Multi (curl.Curl.Multi)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../_odoc-theme/odoc.css"/><meta name="generator" content="odoc 3.0.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">Index</a> &#x00BB; <a href="../../index.html">curl</a> &#x00BB; <a href="../index.html">Curl</a> &#x00BB; Multi</nav><header class="odoc-preamble"><h1>Module <code><span>Curl.Multi</span></code></h1><p>Curl multi stack. Functions may raise <code>Failure</code> on critical errors</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-mt"><a href="#type-mt" class="anchor"></a><code><span><span class="keyword">type</span> mt</span></code></div><div class="spec-doc"><p>type of Curl multi stack</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-curlPipelining"><a href="#type-curlPipelining" class="anchor"></a><code><span><span class="keyword">type</span> curlPipelining</span><span> = </span></code><ol><li id="type-curlPipelining.PIPE_NOTHING" class="def variant constructor anchored"><a href="#type-curlPipelining.PIPE_NOTHING" class="anchor"></a><code><span>| </span><span><span class="constructor">PIPE_NOTHING</span></span></code></li><li id="type-curlPipelining.PIPE_HTTP1" class="def variant constructor anchored"><a href="#type-curlPipelining.PIPE_HTTP1" class="anchor"></a><code><span>| </span><span><span class="constructor">PIPE_HTTP1</span></span></code></li><li id="type-curlPipelining.PIPE_MULTIPLEX" class="def variant constructor anchored"><a href="#type-curlPipelining.PIPE_MULTIPLEX" class="anchor"></a><code><span>| </span><span><span class="constructor">PIPE_MULTIPLEX</span></span></code></li></ol></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-curlMultiOption"><a href="#type-curlMultiOption" class="anchor"></a><code><span><span class="keyword">type</span> curlMultiOption</span><span> = </span></code><ol><li id="type-curlMultiOption.CURLMOPT_PIPELINING" class="def variant constructor anchored"><a href="#type-curlMultiOption.CURLMOPT_PIPELINING" class="anchor"></a><code><span>| </span><span><span class="constructor">CURLMOPT_PIPELINING</span> <span class="keyword">of</span> <span><a href="#type-curlPipelining">curlPipelining</a> list</span></span></code></li><li id="type-curlMultiOption.CURLMOPT_MAXCONNECTS" class="def variant constructor anchored"><a href="#type-curlMultiOption.CURLMOPT_MAXCONNECTS" class="anchor"></a><code><span>| </span><span><span class="constructor">CURLMOPT_MAXCONNECTS</span> <span class="keyword">of</span> int</span></code></li><li id="type-curlMultiOption.CURLMOPT_MAX_PIPELINE_LENGTH" class="def variant constructor anchored"><a href="#type-curlMultiOption.CURLMOPT_MAX_PIPELINE_LENGTH" class="anchor"></a><code><span>| </span><span><span class="constructor">CURLMOPT_MAX_PIPELINE_LENGTH</span> <span class="keyword">of</span> int</span></code></li><li id="type-curlMultiOption.CURLMOPT_MAX_HOST_CONNECTIONS" class="def variant constructor anchored"><a href="#type-curlMultiOption.CURLMOPT_MAX_HOST_CONNECTIONS" class="anchor"></a><code><span>| </span><span><span class="constructor">CURLMOPT_MAX_HOST_CONNECTIONS</span> <span class="keyword">of</span> int</span></code></li><li id="type-curlMultiOption.CURLMOPT_MAX_TOTAL_CONNECTIONS" class="def variant constructor anchored"><a href="#type-curlMultiOption.CURLMOPT_MAX_TOTAL_CONNECTIONS" class="anchor"></a><code><span>| </span><span><span class="constructor">CURLMOPT_MAX_TOTAL_CONNECTIONS</span> <span class="keyword">of</span> int</span></code></li></ol></div></div><div class="odoc-spec"><div class="spec exception anchored" id="exception-Error"><a href="#exception-Error" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Error</span> <span class="keyword">of</span> string</span></code></div><div class="spec-doc"><p>exception raised on internal errors</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-cerror"><a href="#type-cerror" class="anchor"></a><code><span><span class="keyword">type</span> cerror</span></code></div></div><div class="odoc-spec"><div class="spec exception anchored" id="exception-CError"><a href="#exception-CError" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">CError</span> <span class="keyword">of</span> string * <a href="#type-cerror">cerror</a> * string</span></code></div><div class="spec-doc"><p>exception raised on libcurl errors : origin * code * message</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create"><a href="#val-create" class="anchor"></a><code><span><span class="keyword">val</span> create : <span>unit <span class="arrow">&#45;&gt;</span></span> <a href="#type-mt">mt</a></span></code></div><div class="spec-doc"><p>create new multi stack</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add"><a href="#val-add" class="anchor"></a><code><span><span class="keyword">val</span> add : <span><a href="#type-mt">mt</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../index.html#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>add handle to multi stack</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-remove"><a href="#val-remove" class="anchor"></a><code><span><span class="keyword">val</span> remove : <span><a href="#type-mt">mt</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../index.html#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>remove handle from multi stack (effectively halting the transfer)</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-perform"><a href="#val-perform" class="anchor"></a><code><span><span class="keyword">val</span> perform : <span><a href="#type-mt">mt</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p>perform pending data transfers (if any) on all handles currently in multi stack</p><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p>the number of handles that still transfer data</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-wait"><a href="#val-wait" class="anchor"></a><code><span><span class="keyword">val</span> wait : <span><span class="optlabel">?timeout_ms</span>:int <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-mt">mt</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>wait till there are some active data transfers on multi stack</p><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p>whether <code>perform</code> should be called</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-poll"><a href="#val-poll" class="anchor"></a><code><span><span class="keyword">val</span> poll : <span><span class="optlabel">?timeout_ms</span>:int <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-mt">mt</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>poll till there are some active data transfers on multi stack. Contrary to <code>wait</code>, this function does not return immediately when there are no pending transfer but waits for <code>timeout_ms</code> The module falls back to <code>wait</code> if this function is unavailable.</p><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p>whether <code>perform</code> should be called</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-remove_finished"><a href="#val-remove_finished" class="anchor"></a><code><span><span class="keyword">val</span> remove_finished : <span><a href="#type-mt">mt</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="../index.html#type-t">t</a> * <a href="../index.html#type-curlCode">curlCode</a>)</span> option</span></span></code></div><div class="spec-doc"><p>remove finished handle from the multi stack if any. The returned handle may be reused</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-cleanup"><a href="#val-cleanup" class="anchor"></a><code><span><span class="keyword">val</span> cleanup : <span><a href="#type-mt">mt</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>destroy multi handle (all transfers are stopped, but individual <a href="../index.html#type-t"><code>Curl.t</code></a> handles can be reused)</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-poll"><a href="#type-poll" class="anchor"></a><code><span><span class="keyword">type</span> poll</span><span> = </span></code><ol><li id="type-poll.POLL_NONE" class="def variant constructor anchored"><a href="#type-poll.POLL_NONE" class="anchor"></a><code><span>| </span><span><span class="constructor">POLL_NONE</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>none</p><span class="comment-delim">*)</span></div></li><li id="type-poll.POLL_IN" class="def variant constructor anchored"><a href="#type-poll.POLL_IN" class="anchor"></a><code><span>| </span><span><span class="constructor">POLL_IN</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>available for reading</p><span class="comment-delim">*)</span></div></li><li id="type-poll.POLL_OUT" class="def variant constructor anchored"><a href="#type-poll.POLL_OUT" class="anchor"></a><code><span>| </span><span><span class="constructor">POLL_OUT</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>available for writing</p><span class="comment-delim">*)</span></div></li><li id="type-poll.POLL_INOUT" class="def variant constructor anchored"><a href="#type-poll.POLL_INOUT" class="anchor"></a><code><span>| </span><span><span class="constructor">POLL_INOUT</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>both</p><span class="comment-delim">*)</span></div></li><li id="type-poll.POLL_REMOVE" class="def variant constructor anchored"><a href="#type-poll.POLL_REMOVE" class="anchor"></a><code><span>| </span><span><span class="constructor">POLL_REMOVE</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>socket not needed anymore</p><span class="comment-delim">*)</span></div></li></ol></div><div class="spec-doc"><p>events that should be reported for the socket</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-fd_status"><a href="#type-fd_status" class="anchor"></a><code><span><span class="keyword">type</span> fd_status</span><span> = </span></code><ol><li id="type-fd_status.EV_AUTO" class="def variant constructor anchored"><a href="#type-fd_status.EV_AUTO" class="anchor"></a><code><span>| </span><span><span class="constructor">EV_AUTO</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>determine socket status automatically (with extra system call)</p><span class="comment-delim">*)</span></div></li><li id="type-fd_status.EV_IN" class="def variant constructor anchored"><a href="#type-fd_status.EV_IN" class="anchor"></a><code><span>| </span><span><span class="constructor">EV_IN</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>socket has incoming data</p><span class="comment-delim">*)</span></div></li><li id="type-fd_status.EV_OUT" class="def variant constructor anchored"><a href="#type-fd_status.EV_OUT" class="anchor"></a><code><span>| </span><span><span class="constructor">EV_OUT</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>socket is available for writing</p><span class="comment-delim">*)</span></div></li><li id="type-fd_status.EV_INOUT" class="def variant constructor anchored"><a href="#type-fd_status.EV_INOUT" class="anchor"></a><code><span>| </span><span><span class="constructor">EV_INOUT</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>both</p><span class="comment-delim">*)</span></div></li></ol></div><div class="spec-doc"><p>socket status</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_socket_function"><a href="#val-set_socket_function" class="anchor"></a><code><span><span class="keyword">val</span> set_socket_function : <span><a href="#type-mt">mt</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><a href="../../../ocaml/Unix/index.html#type-file_descr">Unix.file_descr</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-poll">poll</a> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>set the function to receive notifications on what socket events are currently interesting for libcurl on the specified socket handle</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_timer_function"><a href="#val-set_timer_function" class="anchor"></a><code><span><span class="keyword">val</span> set_timer_function : <span><a href="#type-mt">mt</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>int <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>set the function to receive notification when libcurl internal timeout changes, timeout value is in milliseconds</p><p>NB <a href="#val-action_timeout"><code>action_timeout</code></a> should be called when timeout occurs</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-action_all"><a href="#val-action_all" class="anchor"></a><code><span><span class="keyword">val</span> action_all : <span><a href="#type-mt">mt</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p>perform pending data transfers (if any) on all handles currently in multi stack (not recommended, <a href="#val-action"><code>action</code></a> should be used instead)</p><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p>the number of handles that still transfer data</p></li></ul><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <a href="#exception-Error"><code>Error</code></a> <p>on errors</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-action_timeout"><a href="#val-action_timeout" class="anchor"></a><code><span><span class="keyword">val</span> action_timeout : <span><a href="#type-mt">mt</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>inform libcurl that timeout occured</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <a href="#exception-Error"><code>Error</code></a> <p>on errors</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-action"><a href="#val-action" class="anchor"></a><code><span><span class="keyword">val</span> action : <span><a href="#type-mt">mt</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../ocaml/Unix/index.html#type-file_descr">Unix.file_descr</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-fd_status">fd_status</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>action mt fd status</code> informs libcurl about event on the specified socket. <code>status</code> specifies socket status. Perform pending data transfers.</p><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p>the number of handles still active</p></li></ul><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <a href="#exception-Error"><code>Error</code></a> <p>on errors</p></li></ul></div></div><div class="odoc-spec"><div class="spec value external anchored" id="val-timeout"><a href="#val-timeout" class="anchor"></a><code><span><span class="keyword">val</span> timeout : <span><a href="#type-mt">mt</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>timeout mt</code> polls multi handle for timeout (not recommended, use <a href="#val-set_timer_function"><code>set_timer_function</code></a> instead).</p><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p>maximum allowed number of milliseconds to wait before calling libcurl to perform actions</p></li></ul><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <a href="#exception-Error"><code>Error</code></a> <p>on errors</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-setopt"><a href="#val-setopt" class="anchor"></a><code><span><span class="keyword">val</span> setopt : <span><a href="#type-mt">mt</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-curlMultiOption">curlMultiOption</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <a href="../index.html#exception-NotImplemented"><code>NotImplemented</code></a> <p>for not implemented option</p></li></ul></div></div></div></body></html>
